---
import CTAButton from './ui/CTAButton.astro';

const ctaUrl = "https://lilian.yt/contact";

const navLinks = [
  { href: "#expertise", label: "Expertise" },
  { href: "#process", label: "Méthode" },
  { href: "#tarifs", label: "Services" },
  { href: "#parcours", label: "À propos" }
];
---

<!-- Navigation Bar -->
<nav class="fixed top-0 w-full z-50 bg-zinc-100/80 backdrop-blur-md border-b border-zinc-200">
  <div class="flex h-16 max-w-7xl mx-auto px-6 items-center justify-between">
    <!-- Logo -->
    <a href="#" class="fluid-text-base tracking-tighter font-semibold flex items-center gap-2">
      <img src="/logo_liliansevoumian.svg" alt="Logo Lilian Sevoumian" class="hidden md:block h-4 w-auto" />
      <span class="text-zinc-900">Lilian Sevoumian</span>
    </a>

    <!-- Navigation Links (Desktop) -->
    <div class="hidden md:flex items-center gap-8 fluid-text-sm font-medium text-zinc-700">
      {navLinks.map((link) => (
        <a href={link.href} class="hover:text-zinc-900 transition-colors duration-150">{link.label}</a>
      ))}
    </div>

    <!-- CTA Button with availability (Desktop) -->
    <div class="hidden md:flex items-center gap-3">
      <span class="flex items-center gap-1.5 fluid-text-xs text-zinc-700">
        <span class="w-1.5 h-1.5 rounded-full bg-zinc-400 animate-pulse"></span>
        Disponible
      </span>
      <CTAButton
        href={ctaUrl}
        text="Discuter de mon projet"
        size="sm"
      />
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-btn"
      class="md:hidden min-h-[44px] min-w-[44px] flex items-center justify-center rounded text-zinc-700 hover:text-zinc-900 transition-colors duration-150"
      aria-label="Ouvrir le menu"
      aria-expanded="false"
    >
      <div class="burger-icon relative w-5 h-3.5">
        <span class="burger-line absolute left-0 top-0 w-full h-0.5 bg-current rounded-sm transition-transform duration-200"></span>
        <span class="burger-line absolute left-0 bottom-0 w-full h-0.5 bg-current rounded-sm transition-transform duration-200"></span>
      </div>
    </button>
  </div>
</nav>

<!-- Mobile Menu (Fullscreen Overlay - Outside nav for proper z-index) -->
<div id="mobile-menu" class="mobile-menu fixed inset-0 top-16 z-[100] bg-zinc-100 md:hidden">
  <div class="mobile-menu-content h-full flex flex-col px-6 py-8">
    <!-- Navigation Links -->
    <div class="flex-1 space-y-2">
      {navLinks.map((link, i) => (
        <a
          href={link.href}
          class="mobile-menu-link block text-2xl font-medium text-zinc-900 hover:text-zinc-700 transition-colors duration-150 py-3"
          style={`--i: ${i}`}
        >
          {link.label}
        </a>
      ))}
    </div>

    <!-- CTA Button at bottom -->
    <div>
      <CTAButton
        href={ctaUrl}
        text="Discuter de mon projet"
        size="lg"
        fullWidth={true}
      />
    </div>
  </div>
</div>

<script>
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');

  function toggleMenu() {
    const isOpen = mobileMenu?.classList.toggle('open');
    menuBtn?.classList.toggle('open', isOpen);
    menuBtn?.setAttribute('aria-expanded', String(isOpen));
    document.body.classList.toggle('menu-open', isOpen);
  }

  menuBtn?.addEventListener('click', toggleMenu);

  // Close menu when clicking a navigation link
  mobileMenu?.querySelectorAll('.mobile-menu-link').forEach(link => {
    link.addEventListener('click', toggleMenu);
  });

  // Close menu on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && mobileMenu?.classList.contains('open')) {
      toggleMenu();
    }
  });
</script>

<style>
  /* Burger → X transformation */
  #mobile-menu-btn.open .burger-line:first-child {
    transform: translateY(7px) rotate(45deg);
  }

  #mobile-menu-btn.open .burger-line:last-child {
    transform: translateY(-7px) rotate(-45deg);
  }

  /* Fullscreen menu - hidden by default */
  .mobile-menu {
    opacity: 0;
    visibility: hidden;
  }

  .mobile-menu.open {
    opacity: 1;
    visibility: visible;
  }

  /* Links - instant display */
  .mobile-menu .mobile-menu-link {
    opacity: 0;
  }

  .mobile-menu.open .mobile-menu-link {
    opacity: 1;
  }

  /* Body scroll lock - must be global to target body element */
  :global(body.menu-open) {
    overflow: hidden;
  }
</style>
