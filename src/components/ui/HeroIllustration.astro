---
// Premium workflow animation - Stripe/Apple quality
// Spring physics, glow effects, breathing modules, dynamic shadows
---

<div class="workflow-hero" id="workflow-hero">
  <svg
    viewBox="0 0 440 280"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
    class="w-full h-full"
  >
    <defs>
      <!-- Subtle dot grid pattern -->
      <pattern id="grid-dots" width="20" height="20" patternUnits="userSpaceOnUse">
        <circle cx="10" cy="10" r="0.6" fill="#e4e4e7"/>
      </pattern>

      <!-- Shadow filter for modules -->
      <filter id="shadow-sm" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#18181b" flood-opacity="0.08"/>
      </filter>
    </defs>

    <!-- Background dots (behind everything) -->
    <rect width="440" height="280" fill="url(#grid-dots)" opacity="0.4"/>

    <!-- CONNECTIONS - clean black lines, no glow -->
    <g class="connections">
      <path class="wf-line wf-line-1" d="M 70 100 L 130 100" stroke="#18181b" stroke-width="2" stroke-linecap="round"/>
      <path class="wf-line wf-line-2" d="M 190 100 L 250 100" stroke="#18181b" stroke-width="2" stroke-linecap="round"/>
      <path class="wf-line wf-line-3" d="M 310 100 C 340 100 350 45 380 45" stroke="#18181b" stroke-width="2" stroke-linecap="round"/>
      <path class="wf-line wf-line-4" d="M 310 100 L 380 100" stroke="#18181b" stroke-width="2" stroke-linecap="round"/>
      <path class="wf-line wf-line-5" d="M 310 100 C 340 100 350 155 380 155" stroke="#18181b" stroke-width="2" stroke-linecap="round"/>
    </g>

    <!-- DATA PARTICLES - placed BEFORE modules so they render behind -->
    <circle class="wf-particle wf-particle-1" r="5" fill="#18181b"/>
    <circle class="wf-particle wf-particle-2" r="5" fill="#18181b"/>
    <circle class="wf-particle wf-particle-3" r="5" fill="#18181b"/>

    <!-- MODULES (white backgrounds to mask dots and particles) -->

    <!-- 1. Trigger - Lightning bolt (universal trigger symbol) -->
    <g class="wf-module wf-module-1" filter="url(#shadow-sm)">
      <rect x="10" y="70" width="60" height="60" rx="14" fill="white" stroke="#18181b" stroke-width="2"/>
      <!-- Clean lightning bolt -->
      <path d="M 46 84 L 34 102 L 42 102 L 38 116 L 52 98 L 44 98 L 46 84 Z" fill="#18181b"/>
    </g>

    <!-- 2. Process - Gear (automation symbol) -->
    <g class="wf-module wf-module-2" filter="url(#shadow-sm)">
      <rect x="130" y="70" width="60" height="60" rx="14" fill="white" stroke="#52525b" stroke-width="2"/>
      <!-- Clean gear icon -->
      <circle cx="160" cy="100" r="8" fill="none" stroke="#52525b" stroke-width="2"/>
      <circle cx="160" cy="100" r="3" fill="#52525b"/>
      <path d="M 160 88 L 160 92 M 160 108 L 160 112 M 148 100 L 152 100 M 168 100 L 172 100" stroke="#52525b" stroke-width="2.5" stroke-linecap="round"/>
      <path d="M 151.5 91.5 L 154.5 94.5 M 165.5 105.5 L 168.5 108.5 M 151.5 108.5 L 154.5 105.5 M 165.5 94.5 L 168.5 91.5" stroke="#52525b" stroke-width="2.5" stroke-linecap="round"/>
    </g>

    <!-- 3. Router - Diamond (standard routing symbol) -->
    <g class="wf-module wf-module-3" filter="url(#shadow-sm)">
      <rect x="250" y="70" width="60" height="60" rx="14" fill="#18181b"/>
      <!-- Diamond with question mark -->
      <path d="M 280 86 L 294 100 L 280 114 L 266 100 Z" fill="none" stroke="white" stroke-width="2"/>
      <text x="280" y="104" text-anchor="middle" fill="white" font-size="12" font-weight="600" font-family="system-ui">?</text>
    </g>

    <!-- 4. Output: Notification bell -->
    <g class="wf-module wf-module-4" filter="url(#shadow-sm)">
      <rect x="380" y="20" width="50" height="50" rx="12" fill="white" stroke="#71717a" stroke-width="1.5"/>
      <!-- Bell icon -->
      <path d="M 405 34 C 400 34 396 38 396 44 L 396 48 L 394 50 L 416 50 L 414 48 L 414 44 C 414 38 410 34 405 34 Z" fill="none" stroke="#52525b" stroke-width="2" stroke-linejoin="round"/>
      <path d="M 402 50 L 402 52 C 402 54 403.5 55 405 55 C 406.5 55 408 54 408 52 L 408 50" fill="none" stroke="#52525b" stroke-width="2"/>
      <circle cx="412" cy="35" r="3" fill="#52525b"/>
    </g>

    <!-- 5. Output: Document/file -->
    <g class="wf-module wf-module-5" filter="url(#shadow-sm)">
      <rect x="380" y="75" width="50" height="50" rx="12" fill="white" stroke="#71717a" stroke-width="1.5"/>
      <!-- Document icon -->
      <path d="M 395 86 L 395 114 L 415 114 L 415 92 L 409 86 L 395 86 Z" fill="none" stroke="#52525b" stroke-width="2" stroke-linejoin="round"/>
      <path d="M 409 86 L 409 92 L 415 92" fill="none" stroke="#52525b" stroke-width="2" stroke-linejoin="round"/>
      <path d="M 399 99 L 411 99 M 399 105 L 407 105" stroke="#52525b" stroke-width="1.5" stroke-linecap="round"/>
    </g>

    <!-- 6. Output: Send/Export arrow -->
    <g class="wf-module wf-module-6" filter="url(#shadow-sm)">
      <rect x="380" y="130" width="50" height="50" rx="12" fill="white" stroke="#71717a" stroke-width="1.5"/>
      <!-- Send arrow -->
      <path d="M 395 165 L 395 150 L 410 150" fill="none" stroke="#52525b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M 404 145 L 410 150 L 404 156" fill="none" stroke="#52525b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="415" cy="145" r="3" fill="#52525b"/>
    </g>

  </svg>
</div>

<style is:global>
  .workflow-hero {
    width: 100%;
    aspect-ratio: 4/3;
  }

  /* === INITIAL STATES === */
  .wf-module {
    opacity: 0;
    transform: scale(0.7) translateY(8px);
    transform-origin: center;
    transform-box: fill-box;
  }

  .wf-line {
    stroke-dasharray: 100;
    stroke-dashoffset: 100;
  }

  .wf-particle {
    opacity: 0;
  }

  /* === SPRING EASING (Apple-style) === */
  /* cubic-bezier approximating spring with slight overshoot */

  /* === ANIMATED STATES === */
  .workflow-hero.is-animated .wf-module {
    animation: moduleSpring 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

  /* Staggered delays with organic rhythm (not linear) */
  .workflow-hero.is-animated .wf-module-1 { animation-delay: 0ms; }
  .workflow-hero.is-animated .wf-module-2 { animation-delay: 120ms; }
  .workflow-hero.is-animated .wf-module-3 { animation-delay: 280ms; }
  .workflow-hero.is-animated .wf-module-4 { animation-delay: 700ms; }
  .workflow-hero.is-animated .wf-module-5 { animation-delay: 780ms; }
  .workflow-hero.is-animated .wf-module-6 { animation-delay: 860ms; }

  /* Lines draw with easing */
  .workflow-hero.is-animated .wf-line {
    animation: lineDraw 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  .workflow-hero.is-animated .wf-line-1 { animation-delay: 180ms; }
  .workflow-hero.is-animated .wf-line-2 { animation-delay: 380ms; }
  .workflow-hero.is-animated .wf-line-3 { animation-delay: 650ms; }
  .workflow-hero.is-animated .wf-line-4 { animation-delay: 700ms; }
  .workflow-hero.is-animated .wf-line-5 { animation-delay: 750ms; }

  /* Particles with offset-path - travel along the workflow lines */
  .workflow-hero.is-animated .wf-particle {
    animation: particleTravel 3s cubic-bezier(0.4, 0, 0.2, 1) infinite;
  }

  .workflow-hero.is-animated .wf-particle-1 {
    animation-delay: 1.8s;
    offset-path: path('M 40 100 L 160 100 L 280 100 C 340 100 350 45 405 45');
  }

  .workflow-hero.is-animated .wf-particle-2 {
    animation-delay: 2.4s;
    offset-path: path('M 40 100 L 160 100 L 280 100 L 405 100');
  }

  .workflow-hero.is-animated .wf-particle-3 {
    animation-delay: 3s;
    offset-path: path('M 40 100 L 160 100 L 280 100 C 340 100 350 155 405 155');
  }

  /* Breathing effect on trigger module */
  .workflow-hero.is-animated .wf-module-1 {
    animation:
      moduleSpring 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards,
      moduleBreathe 3s ease-in-out 1.5s infinite;
  }

  /* Subtle pulse on output modules when particle arrives */
  .workflow-hero.is-animated .wf-module-4 {
    animation:
      moduleSpring 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards,
      moduleReceive 3s ease-out 1.8s infinite;
  }

  .workflow-hero.is-animated .wf-module-5 {
    animation:
      moduleSpring 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards,
      moduleReceive 3s ease-out 2.4s infinite;
  }

  .workflow-hero.is-animated .wf-module-6 {
    animation:
      moduleSpring 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards,
      moduleReceive 3s ease-out 3s infinite;
  }

  /* === KEYFRAMES === */
  @keyframes moduleSpring {
    0% {
      opacity: 0;
      transform: scale(0.7) translateY(8px);
    }
    60% {
      opacity: 1;
      transform: scale(1.03) translateY(-2px);
    }
    80% {
      transform: scale(0.98) translateY(1px);
    }
    100% {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  @keyframes lineDraw {
    0% {
      stroke-dashoffset: 100;
    }
    100% {
      stroke-dashoffset: 0;
    }
  }

  @keyframes fadeIn {
    to { opacity: 1; }
  }

  @keyframes particleTravel {
    0% {
      opacity: 0;
      offset-distance: 0%;
    }
    5% {
      opacity: 1;
    }
    90% {
      opacity: 1;
    }
    100% {
      opacity: 0;
      offset-distance: 100%;
    }
  }

  @keyframes moduleBreathe {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.015);
    }
  }

  @keyframes moduleReceive {
    0%, 80% {
      transform: scale(1);
    }
    90% {
      transform: scale(1.04);
    }
    100% {
      transform: scale(1);
    }
  }

  /* === REDUCED MOTION === */
  @media (prefers-reduced-motion: reduce) {
    .wf-module {
      opacity: 1;
      transform: none;
    }
    .wf-line {
      stroke-dashoffset: 0;
    }
    .workflow-hero.is-animated .wf-module,
    .workflow-hero.is-animated .wf-line,
    .workflow-hero.is-animated .wf-particle {
      animation: none;
    }
    .wf-particle {
      opacity: 0;
    }
  }
</style>

<script>
  function initWorkflow() {
    const hero = document.getElementById("workflow-hero");
    if (!hero) return;

    // Set up line lengths for accurate dash animation
    hero.querySelectorAll(".wf-line").forEach(line => {
      const pathEl = line as SVGPathElement;
      const len = pathEl.getTotalLength();
      pathEl.style.strokeDasharray = String(len);
      pathEl.style.strokeDashoffset = String(len);
    });

    // Reduced motion: show immediately without animation
    if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
      hero.classList.add("is-animated");
      return;
    }

    // Intersection Observer to trigger animation
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            hero.classList.add("is-animated");
            observer.disconnect();
          }
        });
      },
      { threshold: 0.25 }
    );

    observer.observe(hero);
  }

  // Initialize
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initWorkflow);
  } else {
    initWorkflow();
  }
</script>
