---
const steps = [
  {
    number: "01",
    title: "Audit",
    description: "On identifie ensemble ce qui vous fait perdre du temps. Vous repartez avec une vision claire des quick wins et des chantiers prioritaires."
  },
  {
    number: "02",
    title: "Conseil",
    description: "Je vous recommande les bons outils selon vos besoins et votre budget. Pas de sur-engineering, juste ce qu'il vous faut."
  },
  {
    number: "03",
    title: "Architecture",
    description: "Je conçois le système avant de le construire. Vous validez les flux et les connexions entre vos outils avant qu'on commence."
  },
  {
    number: "04",
    title: "Construction",
    description: "Je développe, teste, ajuste. Vous voyez l'avancement en temps réel, pas de tunnel de 3 mois sans nouvelles."
  },
  {
    number: "05",
    title: "Livraison",
    description: "Vous recevez une documentation complète, une formation pour vos équipes, et un support maintenance inclus. Vous êtes autonomes."
  },
  {
    number: "06",
    title: "Support & Maintenance",
    description: "Vos process évoluent, vos automatisations aussi. Je reste disponible pour corriger, ajuster et faire évoluer ce qu'on a construit ensemble."
  }
];
---

<section id="process" class="py-24 bg-white border-y border-zinc-200 px-6">
  <div class="max-w-4xl mx-auto">
    <div class="mb-12">
      <h2 class="text-3xl font-semibold text-zinc-900 tracking-tight mb-4">
        Méthodologie
      </h2>
      <p class="text-zinc-500 font-light text-lg">
        Comment je travaille avec vous.
      </p>
    </div>

    <div class="methodology-timeline space-y-10 relative" data-methodology>
      <!-- Animated timeline line -->
      <div class="methodology-line absolute left-[23px] top-2 bottom-2 w-[2px] bg-zinc-300 origin-top" data-timeline-line></div>

      {steps.map((step, index) => {
        // Gradient: 01 = zinc-400 (light) → 06 = zinc-900 (dark)
        const textColors = ['text-zinc-500', 'text-zinc-600', 'text-zinc-700', 'text-zinc-800', 'text-zinc-800', 'text-zinc-900'];
        const borderColors = ['border-zinc-300', 'border-zinc-300', 'border-zinc-300', 'border-zinc-400', 'border-zinc-400', 'border-zinc-500'];
        return (
        <div
          class="methodology-step relative pl-18 md:pl-20 opacity-0"
          data-step
          style={`--step-index: ${index}`}
        >
          <!-- Step number -->
          <div class={`absolute left-0 top-0 w-12 h-12 bg-white border-2 rounded-lg flex items-center justify-center text-base font-bold shadow-sm z-10 ${textColors[index]} ${borderColors[index]}`}>
            {step.number}
          </div>

          <!-- Content -->
          <h3 class="text-lg font-semibold text-zinc-900">
            {step.title}
          </h3>
          <p class="text-zinc-500 mt-2 fluid-text-sm leading-relaxed fluid-prose-lg">
            {step.description}
          </p>
        </div>
      )})}
    </div>
  </div>
</section>

<style>
  .methodology-line {
    transform: scaleY(0);
    transition: transform 1.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .methodology-timeline.is-visible .methodology-line {
    transform: scaleY(1);
  }

  .methodology-step {
    transform: translateY(20px);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  .methodology-timeline.is-visible .methodology-step {
    opacity: 1;
    transform: translateY(0);
    transition-delay: calc(0.2s + var(--step-index) * 0.25s);
  }
</style>

<script>
  const initMethodologyAnimation = () => {
    const timeline = document.querySelector('[data-methodology]');
    if (!timeline) return;

    // Check for reduced motion preference
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      timeline.classList.add('is-visible');
      return;
    }

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            timeline.classList.add('is-visible');
            observer.unobserve(entry.target);
          }
        });
      },
      {
        threshold: 0.2,
        rootMargin: '0px 0px -100px 0px'
      }
    );

    observer.observe(timeline);
  };

  // Run on initial load
  initMethodologyAnimation();

  // Re-run on Astro page transitions
  document.addEventListener('astro:page-load', initMethodologyAnimation);
</script>
