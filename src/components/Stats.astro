---
import { stats } from '../data/stats';
---

<section class="py-8 bg-gradient-to-b from-white to-zinc-50/50 lg:hidden stats-section">
  <div class="max-w-sm mx-auto px-6 flex flex-col gap-3">
    {stats.map((stat) => (
      <div class="flex items-center justify-between py-3 border-b border-zinc-100 last:border-0 stat-row">
        <span class="fluid-text-xs text-zinc-500 uppercase">{stat.label}</span>
        <span
          class="fluid-h5 font-semibold text-zinc-900 stat-counter-mobile"
          data-target={stat.value}
          data-suffix={stat.suffix}
          data-format={stat.format ? "true" : "false"}
        >
          0{stat.suffix}
        </span>
      </div>
    ))}
  </div>
</section>

<style>
  .stats-section {
    position: relative;
  }

  .stat-row {
    opacity: 0;
    transform: translateX(-10px);
    animation: stat-slide-in 0.5s ease-out forwards;
  }

  .stat-row:nth-child(1) { animation-delay: 0.1s; }
  .stat-row:nth-child(2) { animation-delay: 0.2s; }
  .stat-row:nth-child(3) { animation-delay: 0.3s; }

  @keyframes stat-slide-in {
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>

<script>
  import { animateCounter } from '../utils/counter';

  // Use IntersectionObserver for reliable detection
  const initCounters = () => {
    const counters = document.querySelectorAll('.stat-counter-mobile');

    if ('IntersectionObserver' in window) {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && !entry.target.classList.contains('animated')) {
            entry.target.classList.add('animated');
            animateCounter(entry.target as HTMLElement);
          }
        });
      }, { threshold: 0.1 });

      counters.forEach(counter => observer.observe(counter));
    } else {
      // Fallback for older browsers
      counters.forEach(counter => {
        counter.classList.add('animated');
        animateCounter(counter as HTMLElement);
      });
    }
  };

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCounters);
  } else {
    initCounters();
  }
</script>
